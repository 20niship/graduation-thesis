# gainTuner
## Abstaract
- モータ一個一個のゲインをデバックする目的の実行文．
- remoteGloveや``remoteSecondGlove``と違い，host側からゲインも受信
- さらに，トルク制御時の速度指令や電流指令をhost側のPCに返せる
- ただし，一度に一個のモータしかまわせない．
- 引数で，起動するaxisを定義．例えば1なら"a01"のみに通電．5なら"a05"のみに通電．
- ``mbusStartIdlist``（.h内）で通信する配列番号を定義．
基本的にはremoteGloveと同じ
-- mbusStartIdlistに配列番号を追加  
-- TorControlsクラスで，トルク制御を定義(EASIIが吐いた値を参考に決定．修論参照) で出来る  
- 多分，制御則を変えない限り作り変える必要ないです．汎用的です．

## TorControls.cpp
- 速度をP制御，指令電流をPI制御．
- Elmo DriverのQuick-tuningの結果を参考にすぐにゲインが決められる．
- また，電流にはthresholdも設けている．過電流を防ぐため．

## Session start
- ISIwiki参照
- 引数に挙動を見たい（これから動かす）axisのIDをセット．例えばa01なら引数は0ではなく``1``なので注意
```bash
$ ./gainTuner.pexe <AxisID>
```
- あとはlocal側で対応したコードを回しましょう．

## Modbus ID
- 主に番号の定義は`` gainTuner.h ``内部で行う．
- 他とも同じだか，まず時間情報（時，分，秒，ミリ秒）はmodbusの0~7まで，2つずつIDを使用して
送受信している．32bitと想定した場合に16bitずつにわけて通信しているため，
- 10~15はそれぞれ，elmoが読み取った（つまりマクソンモータ底部の）
pos[cnt], velocity[cnt/s], current [mA]が記述．32bitの3変数をhostに送信するべく，6枠使用
- 16~21はゲイン．
- 22~25はhostから送信されるシグナル．電流上限と目標角度
- 26~は電流制御内部の情報．作成した指令速度と指令電流．これらが12~15の値に
ちゃんと追従しているかどうかをhost側で確認するために使用．

## Tips
### ゲインの値がEASIIで出た値と少し違う？
- 速度制御の比例ゲインに注意．EAS2が予想するデフォルト値が10のマイナス5乗オーダーなので，
それを10の7乗倍したものがホストPCから送信される設定にしてある．
- なので``TorControls::set_GainAgan``内では受信したものを10の7乗倍してる．
- 他3つのゲインも似たような理由で補正
### 開発時の注意
- Modbusで，server側レジスタのmodbusIDとローカル側のregisterのIDは全然別物．
これだけ抑えれば大丈夫．
- たとえばserver側でID＝10~15に格納された値をlocal側のregister(``mbus_read_out``)に
格納する（つまり，開始ID＝10, 6つの値をローカルに保存すると記述）とき，
ローカル側のregiaterの0番目から順にそれらの値が格納されます
- このコードはローカル側の番地とサーバー側の番地を合わせたかったので，
0番目から一気にローカルにコピーしています
